function copy(a){return angular.isObject(a)&&!angular.isFunction(a)?JSON.parse(JSON.stringify(a)):angular.copy(a)}function createScope(a){var b=mox.inject("$rootScope").$new();return a&&angular.extend(b,a),currentSpec.$scope=b,b}function createController(a,b,c){return mox.inject("$controller")(a,angular.extend({$scope:b||currentSpec.$scope},c||{}))}function mockDate(a){var b;beforeEach(function(){b=sinon.useFakeTimers(+new Date(a))}),afterEach(function(){b.restore()})}function getMockData(a){return copy(getJSONFixture(a))}function noop(){}function compileHtml(a,b,c){b=b||currentSpec.$scope,void 0===c&&(c=!0);var d=mox.inject("$compile")(a)(b),e=angular.element(document.body);if(e.find(mox.testTemplateAppendSelector).remove(),c){var f=mox.testTemplatePath?jasmine.getFixtures().read(mox.testTemplatePath):angular.element('<div id="mox-container">');e.append(f).find(mox.testTemplateAppendSelector).append(d)}return currentSpec.element=d,b.$digest(),currentSpec.element}function compileTemplate(a,b,c){var d=mox.inject("$templateCache").get(a);return compileHtml("<div>"+d+"</div>",b,c)}function compileHtmlOnDom(a,b){var c=compileHtml(a,b),d=mox.inject("$document").find("body"),e="test-input-container",f=function(){return d.find("#"+e)};return f().length<1&&d.append('<div id="'+e+'"></div>'),f().append(c),c}function removeCompiledHtmlFromDom(){return mox.inject("$document").find("body").find("#test-input-container").remove()}function defer(){return mox.inject("$q").defer()}function when(){return mox.inject("$q").when.apply(this,arguments)}function all(){return mox.inject("$q").all.apply(this,arguments)}function unresolvedPromise(){return defer().promise}function promise(a,b){var c=defer();return c.resolve(b?a:copy(a)),c.promise}function restangularPromise(a){return mox.inject("$q").when(angular.copy(a))}function resourcePromise(a){var b=defer();return b.resolve(angular.copy(a)),b.promise}function reject(a){return mox.inject("$q").reject(a)}function resourceResult(a,b){return angular.forEach(b,function(b,c){"$"===c[0]&&(a[c]=b)}),{$promise:b?resourcePromise(a):promise(a)}}function nonResolvingResourceResult(){return{$promise:unresolvedPromise()}}function rejectingResourceResult(a){return{$promise:reject(a)}}function extendElement(a){return a.findBinding=function(b){var c=a.find(".ng-binding"),d=[];return angular.forEach(c,function(a){var c=angular.element(a).data("$binding");if(c){var e=c.exp||c[0].exp||c;-1!==e.indexOf(b)&&d.push(a)}}),angular.element(d)},a}function extendedElement(a,b){var c={};return angular.forEach(b,function(b,d){c[d]=a.find(b)}),angular.extend(a,c)}function extendedElementWithChildren(a,b){var c=[];angular.forEach(a.children(),function(a){c.push(angular.element(a))});var d={};return angular.forEach(c,function(a,c){d[b[c]]=a}),angular.extend(a,d)}function addSelectors(a,b){function c(a,b,c){var d=a[b];if(angular.isUndefined(d))a[b]=c;else if(!angular.isFunction(d)||"moxExtendElement"!==d.name)throw Error("Property "+b+" already defined on element")}function d(a,b){angular.forEach(b,function(b,d){var e=angular.isObject(b)?b.name:b,f=b.sub;c(a,e,function(){var b=a.children().eq(d);return addSelectors(b,f),b})})}function e(a,b,c){if(b){if(angular.isString(b)||b.selector){var d=(b.selector||b).replace(/{(\d+)}/g,function(a,b){return c[b]});return a.find(d)}if(b.repeater){var e=a.find(b.repeater);return angular.isDefined(c[0])?e.eq(c[0]):e}}return angular.element(a)}return angular.forEach(b,function(b,f){var g=b.children,h=b.sub;c(a,f,function(){var c=e(a,b,arguments);return(!b.repeater||angular.isDefined(arguments[0]))&&(addSelectors(c,h),d(c,g)),c})}),a}function requestTest(){function a(a){return c._expectedQueryParams?(expect(a).toHaveQueryParams(c._expectedQueryParams),c._path?a.indexOf(c._path)>=0:!0):c._path===a}var b=this,c={_httpMethod:"GET",_data:null};return c._expectedResult=c._response,c.whenPath=function(a){return c._path=a,c},c.whenMethod=function(a){return c._method=a,c._methodArguments=Array.prototype.slice.call(arguments,1),c},c.whenCall=c.whenMethod,c.whenHttpMethod=function(a){return c._httpMethod=a,c},c.whenData=function(a){return c._data=a,c},c.expectRequest=function(a,b,d){return c.whenHttpMethod(a),c.whenPath(b),c.whenData(d),c},c.andRespond=function(a){return c._response=a,c._expectedResult=c._response,c},c.andExpect=function(a){return c._expectedResult=a,c},c.expectGet=function(a){return c.expectRequest("GET",a)},c.expectPost=function(a,b){return c.expectRequest("POST",a,b)},c.expectPut=function(a,b){return c.expectRequest("PUT",a,b)},c.expectDelete=function(a,b){return c.expectRequest("DELETE",a,b)},c.expectQueryParams=function(a){return c._expectedQueryParams=a,c},c.fail=function(){c._expectFail=!0,c.run()},c.run=function(){c._response=c._response||{},mox.inject("$httpBackend").expect(c._httpMethod,{test:a},c._data).respond(c._response);var d=c._method.apply(this,c._methodArguments),e=d.$promise||d;if(angular.isFunction(c._expectedResult)){var f=jasmine.createSpy("success callback"),g=jasmine.createSpy("failure callback");e.then(f)["catch"](g),mox.inject("$httpBackend").flush();var h=c._expectFail?g:f;c._expectedResult(b.isJasmine2?h.calls.mostRecent().args[0]:h.mostRecentCall.args[0])}else mox.inject("$httpBackend").flush(),c._expectFail?expect(e).toReject():expect(e).toResolve()},c}function MoxBuilder(){function a(){var a;return g.length&&(a=angular.mock.module.apply(this,g),angular.mock.inject()),h.forEach(function(a){a()}),a}function b(){f=[],g=[],h=[]}function c(a){if(!a[0])throw Error("Please provide arguments")}function d(a){var b=function(b){return angular.extend({},a,b)};return a.constructor=jasmine.createSpy("constructor"),currentSpec.isJasmine2?a.constructor.and.callFake(b):a.constructor.andCallFake(b),angular.extend(a.constructor,a),a.constructor}function e(a){return angular.isFunction(a)&&"Resource"!==a.name}var f,g,h;return b(),this.factories=moxConfig,this.get={},this.testTemplateAppendSelector="#mox-container",this.inject=function(a){if(!currentSpec.$injector)throw Error("Sorry, cannot inject "+a+" because the injector is not ready yet. Please call mox.run() or inject()");var b=Array.prototype.slice.call(arguments,0),c={};return angular.forEach(b,function(a){c[a]=currentSpec.$injector.get(a)}),1===b.length?c[a]:c},this.module=function(){var a=Array.prototype.slice.call(arguments,0);return angular.forEach(a,function(a){angular.isString(a)&&f.push(a)}),g=g.concat(a),this},this.mockServices=function(){function a(a){var b=[];return angular.forEach(a,function(a,c){angular.isFunction(a)&&b.push(c)}),b}function b(b){return e(b)?(b={filter:b},b.filter.isSpy||spyOn(b,"filter"),b=b.filter):(angular.forEach(a(b),function(a){b[a].isSpy||spyOn(b,a)}),"Resource"===b.name&&(b=d(b))),b}c(arguments);var f=arguments;return g.push(function(a){angular.forEach(f,function(c){var d;angular.isArray(c)?(d=angular.copy(c),c=d.shift(),d.unshift(a)):d=[a],c in mox.factories?mox.factories[c].apply(this,d):(a.decorator(c,function(a){return c in mox.get||(a=b(a),mox.get[c]=a),a}),h.push(function(){mox.inject(c)}))})}),this},this.mockConstants=function(a){if(c(arguments),angular.isString(a)){var b=arguments[0];a={},a[b]=arguments[1]}return g.push(function(b){angular.forEach(a,function(a,c){mox.save(b,c,a,"constant")})}),this},this.mockDirectives=function(){c(arguments);var a=arguments;return g.push(function(b){angular.forEach(a,function(a){var c=angular.isString(a)?{name:a}:a;b.decorator(c.name+"Directive",function(a){return angular.extend(a[0],{require:c.require||void 0,template:c.template||void 0,templateUrl:c.templateUrl||void 0,transclude:c.transclude||void 0,controller:c.controller||void 0,compile:c.compile||void 0,link:c.link||void 0}),[a[0]]})})}),this},this.disableDirectives=function(){c(arguments);var a=arguments;return g.push(function(b){angular.forEach(a,function(a){b.factory(a+"Directive",function(){return{}})})}),this},this.mockControllers=function(){c(arguments);var a=arguments;return g.push(function(b){angular.forEach(a,function(a){b.register(a,angular.noop)})}),this},this.mockTemplates=function(){c(arguments);var a=arguments;return h.push(function(){var b=mox.inject("$templateCache");angular.forEach(a,function(a){var c,d;angular.isString(a)?(c=a,d="<div>This is a mock for "+c+"</div>"):angular.forEach(a,function(a,b){d=a,c=b}),b.put(c,d)})}),this},this.setupResults=function(a){return h.push(function(){var b=a();angular.forEach(b,function(a,b){function c(a,b){"function"==typeof b?currentSpec.isJasmine2?a.and.callFake(b):a.andCallFake(b):currentSpec.isJasmine2?a.and.returnValue(b):a.andReturn(b)}var d=mox.inject(b);if(!(b in mox.get))throw new Error(b+" is not in mox.get");"object"==typeof a&&a.constructor===Object?angular.forEach(a,function(a,e){if(!(e in d))throw new Error("Could not mock return value. No method "+e+" created in mock for "+b);c(d[e],a)}):c(d,a)})}),this},this.run=function(){var c=a();return b(),c},this.save=function(a,b,c,d){return d=d||"value",a[d](b,c),mox.get[b]=c,c},this.createMock=function(a,b){return function(c,d){var e=angular.isUndefined(b)?jasmine.createSpy(a):b===!1?void 0:jasmine.createSpyObj(a,b);return c&&mox.save(c,d||a,e,b===!1?"constant":void 0),e}},this.createResourceMock=function(a,b){function c(a){e[a]=a,e["$"+a]="$"+a}var e={};return angular.forEach(b,c),function(b){var c=jasmine.createSpyObj(a,Object.keys(e));return c=d(c),b&&mox.save(b,a,c.constructor),c.constructor}},this}var currentSpec;beforeEach(function(){this.isJasmine2=/^2/.test(jasmine.version),currentSpec=this}),"undefined"!=typeof beforeAll&&(angular.mock.clearDataCache=angular.noop);var moxConfig={};angular.module("mox",[]).service("Mox",MoxBuilder);var mox=angular.injector(["mox"]).get("Mox");beforeEach(function(){mox.get={}});